<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "https://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.example.product.dao.ProductDao">

  <insert id="insert" parameterType="Product">
        <selectKey keyProperty="pno" resultType="int" order="BEFORE"> select seq_product_pno.nextval
        from dual </selectKey> insert into product ( pno, pname, pcontent, pprice, pwriter, pdate, phitcount, pattachoname, pattachtype, pattachdata ) values ( #{pno},
        #{pname}, #{pcontent}, #{pprice}, #{pwriter}, sysdate, 0, #{pattachoname}, #{pattachtype}, #{pattachdata} ) </insert>

    <select id="selectByPno"
        parameterType="int"
        resultType="com.example.product.dto.Product"> select * from product where pno = #{pno} </select>

    <update id="updateHitcount"
			parameterType="int"> 
		update product
		set phitcount = phitcount + 1
		where pno = #{pno}
	</update>

    <select id="selectByPage"
            parameterType="Pager"
            resultType="Product">
        <![CDATA[
        select rnum, pno, pname, pwriter, pprice
        from (
                select rownum as rnum, pno, pname, pwriter, pprice
                from (
                        select pno, pname, pwriter, pprice
                        from product
                        order by pno desc
                    )
                where rownum <= #{endRowNo}
            )
        where rnum >= #{startRowNo}
        ]]>        
        </select>

    <update id="update"
            parameterType="Product">
        update product
        set pname = #{pname},
            pcontent = #{pcontent},
            pprice = #{pprice}
            <if test="pattachoname != null">
            , pattachoname = #{pattachoname}
            , pattachtype = #{pattachtype}
            , pattachdata = #{pattachdata}
            </if>
            where pno = #{pno} </update>
        
    <delete id="delete"
        parameterType="int"> delete from product where pno=#{pno} </delete>

    <select id="countAll"
            resultType="int">
        select count(*) from product 
    </select>

</mapper>